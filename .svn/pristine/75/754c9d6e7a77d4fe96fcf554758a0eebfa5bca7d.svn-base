package bd.nmam.history.business.serviceimp;

import java.io.File;
import java.io.FileOutputStream;

import javax.servlet.http.HttpServletRequest;

import org.springframework.stereotype.Service;
import org.springframework.util.ResourceUtils;
import org.springframework.web.multipart.MultipartFile;

import bd.nmam.history.business.service.IStaticSourceManagerService;
import bd.nmam.history.config.AppConfigure;


@Service("StaticSourceManagerImp")
public class StaticSourceManagerImp implements IStaticSourceManagerService{


	@Override
	public String uploadOperate(MultipartFile file, HttpServletRequest request) {
		// TODO Auto-generated method stub
		String result = "http://" + request.getLocalAddr() + ":" + request.getLocalPort() + request.getContextPath();
		try{
			String fileName = AppConfigure.tokenParse(request.getHeader("bd-token"), "account") + "_" + 
				System.currentTimeMillis() + "_" + file.getOriginalFilename();
			String path = ResourceUtils.getURL("classpath:").getPath() + "/static/images/" + fileName;
			File f = new File(path.substring(1));
			if(!f.exists()){
				f.getParentFile().mkdirs();
				f.createNewFile();
			}
			FileOutputStream fos = new FileOutputStream(f);
			fos.write(file.getBytes());
			fos.flush();
			fos.close();
			result += "/static/images/" + fileName;
		}catch(Exception e){
			e.printStackTrace();
		}
		return result;
	}



}
