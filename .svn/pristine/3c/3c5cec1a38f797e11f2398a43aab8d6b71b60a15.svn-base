<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="bd.nmam.manager.business.dao.IDeviceManagerDao">
	<!-- 设备类型 -->
	<select id="loadDeviceType" parameterType = "bd.nmam.manager.business.pojo.DeviceTypePojo" resultType = "bd.nmam.manager.business.pojo.DeviceTypePojo">
		select * from tb_device_type where 1 = 1
		<if test="id != null and id != ''">
			and id = ${id}
		</if>
		<if test="typeName != null and typeName != ''">
			and typeName = #{typeName}
		</if>
		<if test="typeCode != null and typeCode != ''">
			and typeCode = #{typeCode}
		</if>
	</select>
	<insert id="add" parameterType = "bd.nmam.manager.business.pojo.DeviceTypePojo">
		insert into tb_device_type(typeName, typeCode, imgUrl) values(#{typeName}, #{typeCode}, #{imgUrl})
	</insert>
	<delete id="remove" parameterType = "bd.nmam.manager.business.pojo.DeviceTypePojo">
		delete from tb_device_type where id = ${id}
	</delete>
	<update id="modify" parameterType = "bd.nmam.manager.business.pojo.DeviceTypePojo">
		update tb_device_type set typeName = #{typeName}, typeCode = #{typeCode}, imgUrl = #{imgUrl}
		where id = ${id}
	</update>
	<!-- 物理设备 -->
	<insert id="addHardware" parameterType = "bd.nmam.manager.business.pojo.DevicePojo">
		insert into tb_device(dev_id, dev_local_ip, dev_local_port, dev_target_ip, dev_target_port, devType, parentId, areaIndex) 
		values(#{dev_id}, #{dev_local_ip}, #{dev_local_port}, #{dev_target_ip}, #{dev_target_port}, #{devType}, #{parentId}, #{areaIndex})
	</insert>
	<delete id="removeHardware" parameterType = "bd.nmam.manager.business.pojo.DevicePojo">
		delete from tb_device where id = ${id}
	</delete>
	<update id="modifyHardware" parameterType = "bd.nmam.manager.business.pojo.DevicePojo">
		update tb_device set dev_id = #{dev_id}, dev_local_ip = #{dev_local_ip}, dev_local_port = ${dev_local_port}, 
			dev_target_ip = #{dev_target_ip}, dev_target_port = ${dev_target_port}, devType = ${devType}, parentId = ${parentId}, areaIndex = ${areaIndex}
		where id = ${id}
	</update>
	<select id="findHardware" parameterType = "bd.nmam.manager.business.pojo.DevicePojo" resultType = "bd.nmam.manager.business.pojo.DevicePojo">
		SELECT 
			tb_device.id,
			tb_device.dev_id,
			tb_device.dev_local_ip,
			tb_device.dev_local_port,
			tb_device.dev_target_ip,
			tb_device.dev_target_port,
			tb_device_type.typeName,
			tb_device.devType,
			tb_area.areaName,
			tb_area.areaLevel,
			tb_device.areaIndex
		FROM tb_device 
		LEFT JOIN tb_device_type ON tb_device.devType = tb_device_type.id
		LEFT JOIN tb_area ON tb_area.id = tb_device.areaIndex
		where 1 = 1
		<if test="areaIndex != null and areaIndex != 0">
			and tb_device.areaIndex = ${areaIndex}
		</if>
		<if test="devType != null and devType != 0">
			and tb_device.devType = ${devType}
		</if>
		limit ${beginRow}, ${rows}
	</select>
	<select id="findHardwareCount" parameterType = "bd.nmam.manager.business.pojo.DevicePojo" resultType = "Integer">
		SELECT 
			count(*)
		FROM tb_device 
		LEFT JOIN tb_device_type ON tb_device.devType = tb_device_type.id
		LEFT JOIN tb_area ON tb_area.id = tb_device.areaIndex
		where 1 = 1
		<if test="areaIndex != null and areaIndex != 0">
			and tb_device.areaIndex = ${areaIndex}
		</if>
		<if test="devType != null and devType != 0">
			and tb_device.devType = ${devType}
		</if>
	</select>
</mapper>